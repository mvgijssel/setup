# syntax = docker/dockerfile:experimental
ARG IMAGE_SHA_TAG=latest
ARG DOCKER_REGISTRY
FROM ${DOCKER_REGISTRY}/image-builder:${IMAGE_SHA_TAG}

ARG LOCAL_ELEMENTS_DIR
ARG GLOBAL_ELEMENTS_DIR

ADD $LOCAL_ELEMENTS_DIR /app/local_elements
ADD $GLOBAL_ELEMENTS_DIR /app/global_elements

ARG IMAGE_NAME
ARG ELEMENTS

ARG DIB_RELEASE
ARG DIB_APT_MINIMAL_CREATE_INTERFACES
ARG DIB_EXTLINUX

RUN --security=insecure disk-image-create -x -o /app/images/$IMAGE_NAME $ELEMENTS
