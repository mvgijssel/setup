export GITHUB_DOCKER_REGISTRY_URL=docker.pkg.github.com/mvgijssel/setup
export DOCKER_REGISTRY_URL="${GITHUB_DOCKER_REGISTRY_URL}"
export BASE_IMAGE=base-image
export IMAGE_BUILDER_IMAGE=image-builder
export IPXE_IMAGE=ipxe

export LOCAL_NETWORK_DOMAIN=setup.test
export LOCAL_NETWORK_BRIDGE_INTERFACE=bridge1
export LOCAL_NETWORK_INTERNET_INTERFACE=en0
export LOCAL_NETWORK_BRIDGE_IP=192.168.5.1
export LOCAL_NETWORK_NETMASK=255.255.255.0
export LOCAL_NETWORK_BROADCAST=192.168.5.255
export LOCAL_NETWORK_DHCP_START=192.168.5.100
export LOCAL_NETWORK_DHCP_END=192.168.5.200

export KUBERNETES_INGRESS_IP=192.168.5.10
export TF_VAR_kubernetes_ingress_ip="$KUBERNETES_INGRESS_IP"

export KUBERNETES_METALLB_IP_START=192.168.5.10
export TF_VAR_kubernetes_metallb_ip_start="$KUBERNETES_METALLB_IP_START"
export KUBERNETES_METALLB_IP_END=192.168.5.30
export TF_VAR_kubernetes_metallb_ip_end="$KUBERNETES_METALLB_IP_END"

export LIBVIRT_HOSTNAME="libvirt"
export LIBVIRT_FQDN="$LIBVIRT_HOSTNAME.$LOCAL_NETWORK_DOMAIN"
export LIBVIRT_VM_DIR="/data/vms"

export RADARR_HOSTNAME="radarr"
export RADARR_FQDN="$RADARR_HOSTNAME.$LOCAL_NETWORK_DOMAIN"

export DIGITAL_REBAR_HOSTNAME="digital-rebar"
export DIGITAL_REBAR_FQDN="$DIGITAL_REBAR_HOSTNAME.$LOCAL_NETWORK_DOMAIN"
export RS_ENDPOINT="https://$DIGITAL_REBAR_FQDN:8092"

export TF_VAR_libvirt_vm_dir="$LIBVIRT_VM_DIR"
export TF_VAR_libvirt_fqdn="$LIBVIRT_FQDN"
export TF_VAR_parent_domain="$LOCAL_NETWORK_DOMAIN"
export TF_VAR_radarr_hostname="$RADARR_HOSTNAME"
export TF_VAR_radarr_fqdn="$RADARR_FQDN"

# Only if the CI variable does not exist
# If NOT on the CI, executing on local machine
if [ -z "${CI+x}" ]; then
  export CI=false
fi

export CI_SEMAPHORE=false
export CI_GITHUB=false

if [[ "${CI}" = true ]]; then
  export CI=true

  # If NOT semaphore ci use the Github ref
  if [ -z "${SEMAPHORE_GIT_REF+x}" ]; then
      export GIT_REF="${GITHUB_REF}"
      export CI_GITHUB=true
  else
      export GIT_REF="${SEMAPHORE_GIT_REF}"
      export CI_SEMAPHORE=true
  fi

  export GOPATH="$HOME/go"

  # Disable checking for hosts key on the CI
  export ANSIBLE_HOST_KEY_CHECKING=False
else
  export CI=false

  # Only set the GITHUB REF locally (not in the CI)
  export GIT_REF="refs/heads/$(git rev-parse --abbrev-ref HEAD)"

  export ANSIBLE_HOST_KEY_CHECKING=True
fi

export DOCKER_BUILDKIT=0

# export IP_ADDRESS=$(ipconfig getifaddr en0)

export SETUP_ROOT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
export SETUP_SCRIPTS_DIR="${SETUP_ROOT_DIR}/scripts"
export SETUP_LOG_DIR="${SETUP_ROOT_DIR}/log"
export SETUP_IMAGE_DIR="${SETUP_ROOT_DIR}/image"
export SETUP_BOX_DIR="${SETUP_ROOT_DIR}/box"
export SETUP_IPXE_DIR="${SETUP_ROOT_DIR}/ipxe"
export SETUP_TMP_DIR="${SETUP_ROOT_DIR}/tmp"
export SETUP_DIGITAL_REBAR_DIR="${SETUP_ROOT_DIR}/digital-rebar"
export SETUP_KUBERNETES_CORE_DIR="${SETUP_ROOT_DIR}/kubernetes_core"
export SETUP_KUBERNETES_NODES_DIR="${SETUP_ROOT_DIR}/kubernetes_nodes"
export SETUP_UNIFI_DIR="${SETUP_ROOT_DIR}/unifi"
export SETUP_DEPLOY_IMAGE_DIR="${SETUP_ROOT_DIR}/deploy-image"
export SETUP_IMAGE_BUILDER_DIR="${SETUP_ROOT_DIR}/image-builder"
export SETUP_ELEMENTS_DIR="${SETUP_ROOT_DIR}/elements"
export ELEMENTS_PATH="$SETUP_ELEMENTS_DIR"
export SETUP_LIBVIRT_DIR="${SETUP_ROOT_DIR}/libvirt"
export SETUP_DNSMASQ_DIR="${SETUP_ROOT_DIR}/dnsmasq"
export SETUP_SECRETS_DIR="${SETUP_ROOT_DIR}/secrets"

export LOCAL_NETWORK_SSH_CONFIG_PATH="$SETUP_TMP_DIR/ssh_config"

export PRIVATE_KEY_PATH="$SETUP_SECRETS_DIR/id_rsa.development"
export PUBLIC_KEY_PATH="$SETUP_SECRETS_DIR/id_rsa.development.pub"
export TF_VAR_public_key_path="${PUBLIC_KEY_PATH}"

export KUBERNETES_CONFIG_PATH="$SETUP_TMP_DIR/kube_config"
export KUBECONFIG="$KUBERNETES_CONFIG_PATH"
export KUBE_CONFIG="$KUBECONFIG"
export TF_VAR_kube_config_path="$KUBECONFIG"

export TF_VAR_setup_root_dir="${SETUP_ROOT_DIR}"
export TF_VAR_setup_secrets_dir="${SETUP_SECRETS_DIR}"

# Ensure gnutar tar binary is in front of the path
export PATH=\
"${SETUP_SCRIPTS_DIR}:"\
"/usr/local/opt/gnu-tar/libexec/gnubin:"\
"${PATH}"
